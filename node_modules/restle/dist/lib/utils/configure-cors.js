/**
 * This utility configures CORS for the Restle app.
 *
 * @todo Make the CORS more configurable via some sort of options object.
 * @private
 * @param {String} name
 * @return {String}
 */
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

exports['default'] = function (instance) {
  instance.app.use(function (req, res, next) {
    var cors = instance.cors;
    var origin = req.get('origin');

    if (!cors) return next();

    var isOriginAllowed = cors === '*' || (Array.isArray(cors) ? cors.indexOf(origin) > -1 : origin === cors);

    if (isOriginAllowed) {
      var allowedHeaders = ['Origin', 'X-Requested-With', 'Content-Type', 'Accept', 'Authorization'];

      var allowedMethods = ['OPTIONS', 'GET', 'POST', 'PATCH', 'DELETE'];

      res.set('access-control-allow-origin', origin);
      res.set('access-control-allow-headers', allowedHeaders);
      res.set('access-control-allow-methods', allowedMethods);
    }

    if (req.method === 'OPTIONS') return res.sendStatus(isOriginAllowed ? 200 : 403);

    return next();
  });
};

module.exports = exports['default'];