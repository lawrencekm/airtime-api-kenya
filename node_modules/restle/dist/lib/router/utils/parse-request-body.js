'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = serializeRequest;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

/**
 * Serializes the request body into flat JSON that the Restle ORM can consume.
 *
 * @private
 * @param {Object} body
 * @return {Object} body
 */

function serializeRequest(body) {
  var data = body.data;
  var serialized = {};

  // collect attributes
  _lodash2['default'].each(_lodash2['default'].keys(data.attributes), function (attribute) {
    serialized[attribute] = data.attributes[attribute];
  });

  // collect relationships
  _lodash2['default'].forOwn(data.relationships, function (value, relationship) {
    var relationshipData = value.data;

    if (_lodash2['default'].isEmpty(relationshipData) && _lodash2['default'].isArray(relationshipData)) {
      serialized[relationship] = [];
      return;
    }

    if (_lodash2['default'].isNull(relationshipData)) {
      serialized[relationship] = null;
      return;
    }

    if (_lodash2['default'].isArray(relationshipData)) {
      serialized[relationship] = [];

      _lodash2['default'].each(relationshipData, function (relation) {
        serialized[relationship].push(relation.id);
      });
    } else {
      serialized[relationship] = relationshipData.id;
    }
  });

  return serialized;
}

module.exports = exports['default'];